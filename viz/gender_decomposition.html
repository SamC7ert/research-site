<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenderDecomposition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body, #root {
            width: 100%;
            height: 100%;
            background-color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js"></script>

    <script type="text/babel">
        const { useState } = React;

// Data from paper Table 6: Gini × ln(equipment cost) by gender
const table6 = [
  { sample: "Full Individual", n: 1165, dv: "Total", beta: -0.676, p: 0.054 },
  { sample: "Full Individual", n: 1165, dv: "Women", beta: -0.356, p: 0.043 },
  { sample: "Full Individual", n: 1165, dv: "Men", beta: -0.323, p: 0.084 },
  { sample: "Upper Individual", n: 813, dv: "Total", beta: -2.537, p: 0.012 },
  { sample: "Upper Individual", n: 813, dv: "Women", beta: -1.318, p: 0.012 },
  { sample: "Upper Individual", n: 813, dv: "Men", beta: -1.276, p: 0.016 },
];

// Data from paper Table 7: Period robustness by gender
const table7 = [
  { period: "P1 (2000–2008)", sample: "Upper", dv: "Total", beta: -2.024, p: 0.004 },
  { period: "P1 (2000–2008)", sample: "Upper", dv: "Women", beta: -1.034, p: 0.007 },
  { period: "P1 (2000–2008)", sample: "Upper", dv: "Men", beta: -1.001, p: 0.016 },
  { period: "P2 (2012–2024)", sample: "Upper", dv: "Total", beta: -3.232, p: 0.035 },
  { period: "P2 (2012–2024)", sample: "Upper", dv: "Women", beta: -1.717, p: 0.032 },
  { period: "P2 (2012–2024)", sample: "Upper", dv: "Men", beta: -1.655, p: 0.021 },
];

// GGI model ladder (Table 8)
const table8 = [
  { model: "M2", controls: "GDP, Pop, GGI", beta: 1022, p: 0.098 },
  { model: "M3", controls: "+ Soviet", beta: 942, p: 0.109 },
  { model: "M4", controls: "+ Region FE", beta: -507, p: 0.479 },
  { model: "M5", controls: "+ Gini", beta: -580, p: 0.446 },
];

const colors = {
  women: "#C2185B",
  men: "#1565C0",
  total: "#616161",
  sig: "#2E7D32",
  insig: "#BDBDBD",
  ggi: "#7B1FA2",
};

// Approximate SE from beta and p using z-test inversion
const seFromBetaP = (beta, p) => {
  // z = Phi^-1(1 - p/2), approximate
  const z = p < 0.001 ? 3.3 : p < 0.01 ? 2.58 : p < 0.05 ? 1.96 : p < 0.1 ? 1.65 : 1.28;
  return Math.abs(beta) / z;
};

const CoefficientPlot = ({ data, title, width = 520, height = 300, showLegend = true }) => {
  const margin = { top: 40, right: 30, bottom: 60, left: 60 };
  const plotW = width - margin.left - margin.right;
  const plotH = height - margin.top - margin.bottom;

  const items = data.map((d, i) => ({
    ...d,
    se: seFromBetaP(d.beta, d.p),
    lo: d.beta - 1.96 * seFromBetaP(d.beta, d.p),
    hi: d.beta + 1.96 * seFromBetaP(d.beta, d.p),
  }));

  const allVals = items.flatMap((d) => [d.lo, d.hi, 0]);
  const minY = Math.min(...allVals) * 1.15;
  const maxY = Math.max(...allVals) * 1.15;
  const rangeY = maxY - minY || 1;

  const xScale = (i) => margin.left + (i + 0.5) * (plotW / items.length);
  const yScale = (v) => margin.top + plotH - ((v - minY) / rangeY) * plotH;
  const zeroY = yScale(0);

  const dvColor = (dv) =>
    dv === "Women" ? colors.women : dv === "Men" ? colors.men : colors.total;

  return (
    <svg width={width} height={height} style={{ fontFamily: "'Inter', sans-serif" }}>
      <text x={width / 2} y={18} textAnchor="middle" fontSize={13} fontWeight={600} fill="#333">
        {title}
      </text>

      {/* Zero line */}
      <line x1={margin.left} x2={width - margin.right} y1={zeroY} y2={zeroY}
        stroke="#999" strokeWidth={1} strokeDasharray="4,3" />

      {/* Grid lines */}
      {[-3, -2, -1, 0, 1].filter(v => v >= minY && v <= maxY).map(v => (
        <g key={v}>
          <line x1={margin.left} x2={width - margin.right} y1={yScale(v)} y2={yScale(v)}
            stroke="#eee" strokeWidth={0.5} />
          <text x={margin.left - 8} y={yScale(v) + 4} textAnchor="end" fontSize={10} fill="#999">{v}</text>
        </g>
      ))}

      {/* Y axis label */}
      <text x={14} y={margin.top + plotH / 2} textAnchor="middle" fontSize={10} fill="#666"
        transform={`rotate(-90, 14, ${margin.top + plotH / 2})`}>
        Gini × ln(equip) β
      </text>

      {/* Data points */}
      {items.map((d, i) => {
        const x = xScale(i);
        const col = dvColor(d.dv);
        const sig = d.p < 0.05;
        return (
          <g key={i}>
            {/* CI whisker */}
            <line x1={x} x2={x} y1={yScale(d.lo)} y2={yScale(d.hi)}
              stroke={col} strokeWidth={2} opacity={0.6} />
            {/* CI caps */}
            <line x1={x - 5} x2={x + 5} y1={yScale(d.lo)} y2={yScale(d.lo)}
              stroke={col} strokeWidth={2} opacity={0.6} />
            <line x1={x - 5} x2={x + 5} y1={yScale(d.hi)} y2={yScale(d.hi)}
              stroke={col} strokeWidth={2} opacity={0.6} />
            {/* Point */}
            <circle cx={x} cy={yScale(d.beta)} r={5}
              fill={sig ? col : "white"} stroke={col} strokeWidth={2} />
            {/* p-value */}
            <text x={x} y={yScale(d.beta) - 10} textAnchor="middle" fontSize={9}
              fill={sig ? col : "#999"} fontWeight={sig ? 600 : 400}>
              {d.p < 0.001 ? "p<.001" : `p=${d.p.toFixed(3)}`}
            </text>
            {/* X label */}
            <text x={x} y={margin.top + plotH + 15} textAnchor="middle" fontSize={9} fill="#666">
              {d.dv}
            </text>
            <text x={x} y={margin.top + plotH + 27} textAnchor="middle" fontSize={8} fill="#999">
              {d.sample || d.period || ""}
            </text>
          </g>
        );
      })}

      {/* Legend */}
      {showLegend && (
        <g transform={`translate(${width - margin.right - 130}, ${margin.top + 5})`}>
          {[
            { label: "Women", color: colors.women },
            { label: "Men", color: colors.men },
            { label: "Total", color: colors.total },
          ].map((l, i) => (
            <g key={l.label} transform={`translate(0, ${i * 16})`}>
              <circle cx={5} cy={0} r={4} fill={l.color} />
              <text x={14} y={4} fontSize={10} fill="#666">{l.label}</text>
            </g>
          ))}
          <g transform={`translate(0, ${3 * 16})`}>
            <circle cx={5} cy={0} r={4} fill="white" stroke="#666" strokeWidth={2} />
            <text x={14} y={4} fontSize={10} fill="#666">Not sig.</text>
          </g>
        </g>
      )}
    </svg>
  );
};

const GGILadder = ({ width = 520, height = 220 }) => {
  const margin = { top: 40, right: 30, bottom: 50, left: 90 };
  const plotW = width - margin.left - margin.right;
  const plotH = height - margin.top - margin.bottom;

  const items = table8.map(d => ({
    ...d,
    se: seFromBetaP(d.beta, d.p),
    lo: d.beta - 1.96 * seFromBetaP(d.beta, d.p),
    hi: d.beta + 1.96 * seFromBetaP(d.beta, d.p),
  }));

  const allVals = items.flatMap(d => [d.lo, d.hi, 0]);
  const minX = Math.min(...allVals) * 1.1;
  const maxX = Math.max(...allVals) * 1.1;
  const rangeX = maxX - minX || 1;

  const xScale = (v) => margin.left + ((v - minX) / rangeX) * plotW;
  const yScale = (i) => margin.top + (i + 0.5) * (plotH / items.length);

  return (
    <svg width={width} height={height} style={{ fontFamily: "'Inter', sans-serif" }}>
      <text x={width / 2} y={18} textAnchor="middle" fontSize={13} fontWeight={600} fill="#333">
        GGI Model Ladder — Galton's Problem
      </text>
      <text x={width / 2} y={32} textAnchor="middle" fontSize={10} fill="#999">
        GGI–performance collapses with regional controls
      </text>

      {/* Zero line */}
      <line x1={xScale(0)} x2={xScale(0)} y1={margin.top} y2={height - margin.bottom}
        stroke="#999" strokeWidth={1} strokeDasharray="4,3" />

      {items.map((d, i) => {
        const y = yScale(i);
        const sig = d.p < 0.05;
        return (
          <g key={i}>
            <line x1={xScale(d.lo)} x2={xScale(d.hi)} y1={y} y2={y}
              stroke={colors.ggi} strokeWidth={2} opacity={0.5} />
            <line x1={xScale(d.lo)} x2={xScale(d.lo)} y1={y - 4} y2={y + 4}
              stroke={colors.ggi} strokeWidth={2} opacity={0.5} />
            <line x1={xScale(d.hi)} x2={xScale(d.hi)} y1={y - 4} y2={y + 4}
              stroke={colors.ggi} strokeWidth={2} opacity={0.5} />
            <circle cx={xScale(d.beta)} cy={y} r={5}
              fill={sig ? colors.ggi : "white"} stroke={colors.ggi} strokeWidth={2} />
            <text x={margin.left - 8} y={y + 4} textAnchor="end" fontSize={10} fill="#666">
              {d.controls}
            </text>
            <text x={xScale(d.hi) + 8} y={y + 4} fontSize={9}
              fill={sig ? colors.ggi : "#999"}>
              p={d.p.toFixed(3)}
            </text>
          </g>
        );
      })}

      <text x={width / 2} y={height - 8} textAnchor="middle" fontSize={10} fill="#666">
        GGI coefficient (β)
      </text>
    </svg>
  );
};

const App = () => {
  const [view, setView] = useState("coefficients");

  const fullSample = table6.filter(d => d.sample === "Full Individual");
  const upperSample = table6.filter(d => d.sample === "Upper Individual");
  const p1 = table7.filter(d => d.period === "P1 (2000–2008)");
  const p2 = table7.filter(d => d.period === "P2 (2012–2024)");

  const btnStyle = (active) => ({
    padding: "6px 14px",
    border: "1px solid #ddd",
    borderRadius: "6px",
    background: active ? "#333" : "white",
    color: active ? "white" : "#666",
    cursor: "pointer",
    fontSize: "12px",
    fontWeight: active ? 600 : 400,
    fontFamily: "'Inter', sans-serif",
  });

  return (
    <div style={{ padding: "20px 24px", fontFamily: "'Inter', sans-serif", maxWidth: 580 }}>
      <h2 style={{ fontSize: 18, fontWeight: 700, marginBottom: 4, color: "#333" }}>
        Gender Decomposition
      </h2>
      <p style={{ fontSize: 12, color: "#999", marginBottom: 16, lineHeight: 1.5 }}>
        The Gini × equipment cost gradient operates on both genders.
        Women slightly more affected — consistent with household budget allocation.
        The aggregate GGI–performance claim is Galton's Problem.
      </p>

      <div style={{ display: "flex", gap: 6, marginBottom: 16, flexWrap: "wrap" }}>
        <button style={btnStyle(view === "coefficients")} onClick={() => setView("coefficients")}>
          By Gender (Table 6)
        </button>
        <button style={btnStyle(view === "periods")} onClick={() => setView("periods")}>
          Period Robustness (Table 7)
        </button>
        <button style={btnStyle(view === "ggi")} onClick={() => setView("ggi")}>
          GGI Ladder (Table 8)
        </button>
      </div>

      {view === "coefficients" && (
        <div>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 8 }}>
            <CoefficientPlot
              data={fullSample}
              title="Full Sample (n=1,165)"
              width={260}
              height={280}
              showLegend={false}
            />
            <CoefficientPlot
              data={upperSample}
              title="Upper GDP Half (n=813)"
              width={260}
              height={280}
              showLegend={true}
            />
          </div>
          <p style={{ fontSize: 11, color: "#888", marginTop: 8, lineHeight: 1.5 }}>
            Filled circles = p &lt; 0.05. Both genders show the gradient in the upper half.
            Women's coefficient slightly larger (~3%), confidence intervals overlap.
          </p>
        </div>
      )}

      {view === "periods" && (
        <div>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 8 }}>
            <CoefficientPlot
              data={p1.map(d => ({ ...d, sample: "Upper" }))}
              title="P1: 2000–2008"
              width={260}
              height={280}
              showLegend={false}
            />
            <CoefficientPlot
              data={p2.map(d => ({ ...d, sample: "Upper" }))}
              title="P2: 2012–2024"
              width={260}
              height={280}
              showLegend={true}
            />
          </div>
          <p style={{ fontSize: 11, color: "#888", marginTop: 8, lineHeight: 1.5 }}>
            Gradient significant for both genders in both periods. Effect grows over time
            (women: −1.03 → −1.72; men: −1.00 → −1.66), suggesting cost barriers more binding.
          </p>
        </div>
      )}

      {view === "ggi" && (
        <div>
          <GGILadder />
          <p style={{ fontSize: 11, color: "#888", marginTop: 8, lineHeight: 1.5 }}>
            The GGI–performance association is positive without controls (β=+1,022) but collapses
            and reverses sign with region FE (β=−507). Same Galton pattern as Gini aggregate.
            The gendered pattern runs through income inequality, not gender equality.
          </p>
        </div>
      )}
    </div>
  );
};

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
</body>
</html>
